<div class="page">
  <!-- Header / Toolbar -->
  <div class="titlebar">
    <h1>Debtor Type Maintenance</h1>

    <div class="toolbar">
      <input
        class="search"
        [(ngModel)]="q"
        placeholder="Search type / description..."
      />
      <button class="btn primary" (click)="onNew()">New</button>
      <button class="btn" [disabled]="!selected" (click)="onEdit()">
        Edit
      </button>
      <button class="btn danger" [disabled]="!selected" (click)="onDelete()">
        Delete
      </button>
    </div>
  </div>

  <!-- Grid -->
  <div class="gridwrap">
    <table>
      <thead>
        <tr>
          <th style="width: 160px">Debtor Type</th>
          <th>Description</th>
          <th>2nd Description</th>
          <th class="text-center" style="width: 120px">Active</th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let r of filteredRows(); trackBy: trackByType"
          (click)="pick(r)"
          [class.active]="isPicked(r)"
        >
          <td class="monospace">{{ r.typeCode }}</td>
          <td>{{ r.description }}</td>
          <td>{{ r.description2nd }}</td>
          <td class="text-center">
            <span
              class="pill"
              [class.ok]="r.active === 'Yes'"
              [class.bad]="r.active === 'No'"
            >
              {{ r.active }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="footer">Records: {{ filteredRows().length }}</div>
  </div>
</div>

<!-- Modal -->
<div class="dialog" *ngIf="showModal">
  <div class="dialog-panel" role="dialog" aria-modal="true">
    <div class="dialog-title">
      {{ isEdit ? "Edit Debtor Type" : "New Debtor Type" }}
      <button class="x" (click)="closeModal()">✕</button>
    </div>

    <div class="dialog-body">
      <div class="grid2">
        <label
          >Debtor Type
          <input
            class="inp"
            [(ngModel)]="form.typeCode"
            [readOnly]="isEdit"
            [class.readonly]="isEdit"
            placeholder="e.g. BK"
          />
        </label>
        <label
          >Description
          <input class="inp" [(ngModel)]="form.description" />
        </label>
      </div>
      <br>
      <div class="grid2">
        <label
          >2nd Description
          <input class="inp" [(ngModel)]="form.description2nd" />
        </label>
        <label
          >Active
          <select class="inp" [(ngModel)]="form.active">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </label>
      </div>
    </div>

    <div class="dialog-actions">
      <button class="btn cancel" (click)="closeModal()">Cancel</button>
      <button class="btn primary" (click)="save()">Save</button>
    </div>
  </div>
</div>
<div class="dialog" *ngIf="showDeleteConfirm">
  <div class="dialog-panel-small" role="dialog" aria-modal="true">
    <div class="dialog-title">
      Delete Debtor Type
      &nbsp;<button class="x" (click)="closeDeleteConfirm()" aria-label="Close">×</button>
    </div>

    <div class="dialog-body">
      <p>
        Are you sure you want to delete
        <b>{{ selected?.typeCode }}</b>
        ?
      </p>
    </div>

    <div class="dialog-actions">
      <button class="btn cancel" (click)="closeDeleteConfirm()">Cancel</button>
      <button class="btn danger" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>
<div class="dialog" *ngIf="showSuccess">
  <div class="dialog-panel-small" role="dialog" aria-modal="true" style="min-width: 360px">
    <div class="dialog-title" style="background: linear-gradient(180deg,#9be28a 0%, #62c84f 100%);">
       Success
      <button class="x" (click)="closeSuccess()" aria-label="Close">×</button>
    </div>
    <div class="dialog-body">
      <p style="margin: 8px 0; font-weight:600; color:#14532d">{{ successMsg }}</p>
    </div>
    <div class="dialog-actions">
      <button class="btn primary" (click)="closeSuccess()">OK</button>
    </div>
  </div>
</div>
