<div class="page">
  <div class="titlebar">
    <h1>Journal Type Maintenance</h1>

    <div class="toolbar">
      <input class="search" [(ngModel)]="q" placeholder="Search type / description..." />
      <button class="btn primary" (click)="onNew()">New</button>
      <button class="btn" [disabled]="!selected" (click)="onEdit()">Edit</button>
      <button class="btn danger" [disabled]="!selected" (click)="onDelete()">Delete</button>
    </div>
  </div>

  <div class="gridwrap">
    <table>
      <thead>
        <tr>
          <th style="width:170px">Journal Type</th>
          <th>Description</th>
          <th style="width:220px">2nd Description</th>
          <th style="width:240px">Entry Type</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of filteredRows(); trackBy: trackByCode"
            (click)="pick(r)"
            [class.active]="isPicked(r)">
          <td class="monospace">{{ r.typeCode }}</td>
          <td class="clip" [title]="r.description">{{ r.description }}</td>
          <td class="clip" [title]="r.description2ND">{{ r.description2ND || '' }}</td>
          <td>{{ getEntryName(r.entrytypeId) }}</td>
        </tr>
      </tbody>
    </table>

    <div class="footer">Records: {{ filteredRows().length }}</div>
  </div>
</div>

<!-- Modal -->
<div class="dialog" *ngIf="showModal">
  <div class="dialog-panel" role="dialog" aria-modal="true">
    <div class="dialog-title">
      {{ isEdit ? 'Edit Journal Type' : 'New Journal Type' }}
      <button class="x" (click)="close()">✕</button>
    </div>

    <div class="dialog-body">
      <div class="grid2">
        <label>Journal Type
          <input class="inp monospace"
                 [(ngModel)]="form.typeCode"
                 [readonly]="isEdit"
                 [class.readonly]="isEdit"
                 placeholder="e.g. BANK-B" />
        </label>

        <label>Description
          <input class="inp" [(ngModel)]="form.description" placeholder="e.g. BANK RECEIPTS AND PAYMENT" />
        </label>
      </div>
      <br>
    <div class="grid2">
        <label>2nd Description
          <input class="inp" [(ngModel)]="form.description2ND" placeholder="Optional" />
        </label>

        <label>Entry Type
          <select class="inp" [(ngModel)]="form.entrytypeId">
            <option *ngFor="let t of entryTypes" [ngValue]="t.id">{{ t.name }}</option>
          </select>
        </label>
      </div>
    </div>

    <div class="dialog-actions">
      <button class="btn cancel" (click)="close()">Cancel</button>
      <button class="btn primary" (click)="save()">Save</button>
    </div>
  </div>
</div>
<div class="dialog" *ngIf="showDeleteConfirm">
  <div class="dialog-panel-small" role="dialog" aria-modal="true">
    <div class="dialog-title">
      Delete Journal Type  &nbsp;<button
        class="x"
        (click)="closeDeleteConfirm()"
        aria-label="Close"
      >
        ×
      </button>
    </div>

    <div class="dialog-body">
      <p>
        Are you sure you want to delete
        <b>{{ selected?.typeCode }}</b>
        ?
      </p>
    </div>

    <div class="dialog-actions">
      <button class="btn" (click)="closeDeleteConfirm()">Cancel</button>
      <button class="btn danger" (click)="Delete()">Delete</button>
    </div>
  </div>
</div>
<div class="dialog" *ngIf="showSuccess">
  <div class="dialog-panel-small" role="dialog" aria-modal="true" style="min-width: 360px">
    <div class="dialog-title" style="background: linear-gradient(180deg,#9be28a 0%, #62c84f 100%);">
       Success
      <button class="x" (click)="closeSuccess()" aria-label="Close">×</button>
    </div>
    <div class="dialog-body">
      <p style="margin: 8px 0; font-weight:600; color:#14532d">{{ successMsg }}</p>
    </div>
    <div class="dialog-actions">
      <button class="btn primary" (click)="closeSuccess()">OK</button>
    </div>
  </div>
</div>
