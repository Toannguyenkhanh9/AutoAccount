<!-- Page Title + Actions -->
<div class="page">
  <div class="titlebar">
    <h1>Creditor Type Maintenance</h1>

    <div class="toolbar">
      <input
        class="search"
        type="text"
        placeholder="Search code / description / category..."
        [(ngModel)]="q"
      />
      <button class="btn primary" (click)="openNew()">New</button>
      <button class="btn" [disabled]="!selectedRow" (click)="openEdit()">
        Edit
      </button>
      <button class="btn danger" [disabled]="!canDelete()" (click)="onDelete()">
        Delete
      </button>
    </div>
  </div>

  <!-- Panel -->
  <div class="panel">
    <div class="panel-body">
      <table class="table">
        <thead>
          <tr>
            <th class="w-140">Creditor Type</th>
            <th>Description</th>
            <th>2nd Description</th>
            <th class="w-140">Active</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let r of filteredRows(); let i = index"
            (click)="onRowClick(i)"
            [class.selected]="selectedIndex === i"
          >
            <td>{{ r.typeCode }}</td>
            <td>{{ r.description }}</td>
            <td>{{ r.description2nd }}</td>
            <td>
              <span class="pill" [class.ok]="r.active" [class.no]="!r.active">
                {{ r.active ? "Yes" : "No" }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="records">Records: {{ filteredRows().length }}</div>
    </div>
  </div>

  <!-- MODAL: moved to body in TS via #modalRoot -->
  <div class="dialog" *ngIf="showModal">
    <div class="dialog-panel" role="dialog">
      <div class="dialog-title">
        {{ isEditing ? "Edit Creditor Type" : "New Creditor Type" }}
        <button class="x" (click)="closeModal()">×</button>
      </div>

      <div class="dialog-body">
        <div class="grid2">
          <label
            >Creditor Type
            <input
              #typeCodeRef
              class="inp"
              [(ngModel)]="editing.typeCode"
              [class.readonly]="isEditing"
              [readonly]="isEditing"
              [class.invalid]="triedSave && !editing.typeCode?.trim()"
            />
            <small class="error" *ngIf="triedSave && !editing.typeCode?.trim()">
              Creditor Type is required.
            </small>
          </label>
          <label
            >Description
            <input class="inp" [(ngModel)]="editing.description" />
          </label>
        </div>
        <br />
        <div class="grid2">
          <label
            >2nd Description
            <input class="inp" [(ngModel)]="editing.description2nd" />
          </label>
          <label
            >Active
            <select class="inp" [(ngModel)]="editing.active">
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </label>
        </div>
      </div>

      <div class="dialog-actions">
        <button class="btn cancel" (click)="closeModal()">Cancel</button>
        <button
          class="btn primary"
          (click)="save(typeCodeRef)"
          [disabled]="!editing.typeCode?.trim()"
        >
          Save
        </button>
      </div>
    </div>
  </div>
  <div class="dialog" *ngIf="showDeleteConfirm">
    <div class="dialog-panel-small" role="dialog" aria-modal="true">
      <div class="dialog-title">
        Delete Creditor Type &nbsp;<button
          class="x"
          (click)="closeDeleteConfirm()"
          aria-label="Close"
        >
          ×
        </button>
      </div>

      <div class="dialog-body">
        <p>
          Are you sure you want to delete
          <b>{{ selectedRow?.typeCode }}</b>
          ?
        </p>
      </div>

      <div class="dialog-actions">
        <button class="btn cancel" (click)="closeDeleteConfirm()">Cancel</button>
        <button class="btn danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>
<div class="dialog" *ngIf="showSuccess">
  <div class="dialog-panel-small" role="dialog" aria-modal="true" style="min-width: 360px">
    <div class="dialog-title" style="background: linear-gradient(180deg,#9be28a 0%, #62c84f 100%);">
       Success
      <button class="x" (click)="closeSuccess()" aria-label="Close">×</button>
    </div>
    <div class="dialog-body">
      <p style="margin: 8px 0; font-weight:600; color:#14532d">{{ successMsg }}</p>
    </div>
    <div class="dialog-actions">
      <button class="btn primary" (click)="closeSuccess()">OK</button>
    </div>
  </div>
</div>
